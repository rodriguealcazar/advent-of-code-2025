import pytest
from io import StringIO

from day07.solution import moved_beams, parse


@pytest.fixture
def diagram() -> str:
    return StringIO(""".......S.......
...............
.......^.......
...............
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............""")


@pytest.fixture
def lines() -> list[str]:
    return [
        "...............",
        ".......^.......",
        "...............",
        "......^.^......",
        "...............",
        ".....^.^.^.....",
        "...............",
        "....^.^...^....",
        "...............",
        "...^.^...^.^...",
        "...............",
        "..^...^.....^..",
        "...............",
        ".^.^.^.^.^...^.",
        "...............",
    ]


def test_parsing(diagram, lines):
    assert ({7}, lines) == parse(diagram)


def test_moving_beams():
    assert {7}, 0 == moved_beams({7}, "...............")
    assert {6, 8}, 1 == moved_beams({7}, ".......^.......")
    assert {5, 7, 9}, 2 == moved_beams({6, 8}, ".......^.......")
